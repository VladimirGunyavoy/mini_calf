# CALF Visualization & Training Framework

3D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—É—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ **CALF (Critic as Lyapunov Function)** - –ø–æ–¥—Ö–æ–¥–∞ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É –æ–±—É—á–µ–Ω–∏—é —Å –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º —Å –≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

## –ß—Ç–æ —ç—Ç–æ?

CALF - —ç—Ç–æ –º–µ—Ç–æ–¥ –æ–±—É—á–µ–Ω–∏—è —Å –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º, –≥–¥–µ:
- **–ö—Ä–∏—Ç–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è –õ—è–ø—É–Ω–æ–≤–∞** –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **–¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã**: TD3 (certified), Relax (uncertified), Fallback (safe nominal policy)
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–∏** –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ 3D** —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è–º–∏, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–º–∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–ê–≥–µ–Ω—Ç –æ–±—É—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ TD3 (Twin Delayed Deep Deterministic policy gradient), –Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É (PD –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä), –µ—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –õ—è–ø—É–Ω–æ–≤–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è
- –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo_url>
cd CALF/ursina

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# Python 3.12 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è PyTorch + CUDA
py -3.12 -m pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### –ó–∞–ø—É—Å–∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

```bash
# –ù–æ–≤—ã–π main (Stage 2) - —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
py -3.12 main.py

# –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (reference)
py -3.12 train_calf_visual.py

# –ü—Ä–æ—Å—Ç–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–∞—Ä—Ö–∏–≤)
py -3.12 old_main.py
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

- **WASD** - –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
- **Scroll** - –∑—É–º
- **Q / Escape** - –≤—ã—Ö–æ–¥
- **P** - –ø–∞—É–∑–∞ –æ–±—É—á–µ–Ω–∏—è
- **H** - –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å heatmap
- **G** - –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å grid overlay
- **+/-** - –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ursina/
‚îú‚îÄ‚îÄ main.py                    # –ù–æ–≤—ã–π main (Stage 2, —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
‚îú‚îÄ‚îÄ train_calf_visual.py       # –°—Ç–∞—Ä—ã–π main (reference, 974 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ old_main.py                # –ê—Ä—Ö–∏–≤ –ø—Ä–æ—Å—Ç–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ config/                    # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ training_config.py     # TrainingConfig (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ visualization_config.py # VisualizationConfig (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îî‚îÄ‚îÄ app_config.py          # AppConfig (–æ–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
‚îÇ
‚îú‚îÄ‚îÄ core/                      # –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ player.py              # Player (–∫–∞–º–µ—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ scene.py               # setup_scene (ground, lights, frame)
‚îÇ   ‚îî‚îÄ‚îÄ application.py         # CALFApplication (builder)
‚îÇ
‚îú‚îÄ‚îÄ physics/                   # –§–∏–∑–∏–∫–∞ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ point_system.py        # PointSystem (1D –º–∞—Å—Å-—Ç–æ—á–∫–∞, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ simulation_engine.py   # SimulationEngine (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏—è–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ vectorized_env.py      # VectorizedEnvironment (batch –∞–≥–µ–Ω—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ agent.py               # Agent (–∞–≥–µ–Ω—Ç —Å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–µ–π)
‚îÇ   ‚îî‚îÄ‚îÄ policies/              # –ü–æ–ª–∏—Ç–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ base_policy.py     # Policy (–±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å)
‚îÇ       ‚îú‚îÄ‚îÄ pd_policy.py       # PDPolicy (PD –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
‚îÇ       ‚îú‚îÄ‚îÄ td3_policy.py      # TD3Policy (Deep RL –∞–≥–µ–Ω—Ç)
‚îÇ       ‚îî‚îÄ‚îÄ calf_policy.py     # CALFPolicy (TD3 + PD + safety)
‚îÇ
‚îú‚îÄ‚îÄ visuals/                   # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ point_visual.py        # PointVisual (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—á–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ line_trail.py          # LineTrail (—Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ —Å –∫–æ–ª—å—Ü–µ–≤—ã–º –±—É—Ñ–µ—Ä–æ–º)
‚îÇ   ‚îú‚îÄ‚îÄ critic_heatmap.py      # CriticHeatmap (Q-value surface)
‚îÇ   ‚îî‚îÄ‚îÄ grid_overlay.py        # GridOverlay (—Å–µ—Ç–∫–∞ –Ω–∞ heatmap)
‚îÇ
‚îú‚îÄ‚îÄ managers/                  # –ú–µ–Ω–µ–¥–∂–µ—Ä—ã —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ input_manager.py       # InputManager (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞)
‚îÇ   ‚îú‚îÄ‚îÄ window_manager.py      # WindowManager (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–æ–º)
‚îÇ   ‚îú‚îÄ‚îÄ zoom_manager.py        # ZoomManager (–∑—É–º –∫–∞–º–µ—Ä—ã)
‚îÇ   ‚îú‚îÄ‚îÄ object_manager.py      # ObjectManager (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ color_manager.py       # ColorManager (—Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞)
‚îÇ   ‚îú‚îÄ‚îÄ ui_manager.py          # UIManager (UI —ç–ª–µ–º–µ–Ω—Ç—ã)
‚îÇ   ‚îî‚îÄ‚îÄ general_object_manager.py # GeneralObjectManager (—Å–≤—è–∑—å —Ñ–∏–∑–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏)
‚îÇ
‚îú‚îÄ‚îÄ training/                  # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±—É—á–µ–Ω–∏—è (Stage 2)
‚îÇ   ‚îú‚îÄ‚îÄ trainer.py             # CALFTrainer (–ª–æ–≥–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è)
‚îÇ   ‚îî‚îÄ‚îÄ visualizer.py          # TrainingVisualizer (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è)
‚îÇ
‚îú‚îÄ‚îÄ utils/                     # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ profiler.py            # PerformanceProfiler (–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îÇ
‚îú‚îÄ‚îÄ tests/                     # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_policies.py
‚îÇ   ‚îú‚îÄ‚îÄ test_vectorized_env.py
‚îÇ   ‚îî‚îÄ‚îÄ test_performance.py
‚îÇ
‚îî‚îÄ‚îÄ llm/                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
    ‚îú‚îÄ‚îÄ PROGRESS.md            # –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞ (Phase 0-9)
    ‚îú‚îÄ‚îÄ PROMPT_FOR_NEXT_AGENT.md # –£—Ä–æ–∫–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ñ–∞–∑
    ‚îî‚îÄ‚îÄ stage_2/               # Stage 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
        ‚îú‚îÄ‚îÄ 00_START_HERE.md   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
        ‚îú‚îÄ‚îÄ 01_OPTIMIZATION_PLAN.md # –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        ‚îú‚îÄ‚îÄ 02_LESSONS_LEARNED.md # –í—ã—É—á–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏
        ‚îî‚îÄ‚îÄ 03_DECISIONS_LOG.md # –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**Physics (–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞)**:
- `PointSystem` - –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å (ODE –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `VectorizedEnvironment` - batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ N –∞–≥–µ–Ω—Ç–æ–≤
- `Policy` - —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (PD, TD3, CALF)

**Visuals (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)**:
- `PointVisual` - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- `LineTrail` - —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ —Å –∫–æ–ª—å—Ü–µ–≤—ã–º –±—É—Ñ–µ—Ä–æ–º
- `CriticHeatmap` - Q-value surface –≤ 3D

**Managers (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)**:
- `ObjectManager` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
- `ZoomManager` - –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–π –∑—É–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–æ—á–∫–∏
- `InputManager` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –º—ã—à–∏

### –ê–≥–µ–Ω—Ç —Å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–µ–π (–∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä)

–ö–∞–∂–¥—ã–π `Agent` –≤–ª–∞–¥–µ–µ—Ç:
- –§–∏–∑–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª—å—é (`PointSystem`)
- –í–∏–∑—É–∞–ª—å–Ω—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º (Entity —à–∞—Ä–∏–∫)
- –¢—Ä–∞–µ–∫—Ç–æ—Ä–∏–µ–π (–∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä —Ç–æ—á–µ–∫)

–ü—Ä–∏ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–æ—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é - –Ω–∏–∫–∞–∫–∏—Ö destroy/create, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤.

### Batch processing

`VectorizedEnvironment` —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç N –∞–≥–µ–Ω—Ç–æ–≤:
- Batch –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π: `policy.get_actions_batch(states)` - 1 GPU –≤—ã–∑–æ–≤
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### CALF –∞–≥–µ–Ω—Ç

3 —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π:

| –†–µ–∂–∏–º | –¶–≤–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| **TD3** | üîµ –°–∏–Ω–∏–π | Certified - –¥–µ–π—Å—Ç–≤–∏–µ –∞–≥–µ–Ω—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ —Ñ—É–Ω–∫—Ü–∏–µ–π –õ—è–ø—É–Ω–æ–≤–∞ |
| **Relax** | üü¢ –ó–µ–ª—ë–Ω—ã–π | Uncertified but relaxed - –∞–≥–µ–Ω—Ç –Ω–µ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ |
| **Fallback** | üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π | Safe nominal policy - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è PD-–ø–æ–ª–∏—Ç–∏–∫–∞ |

### Critic Heatmap

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Q-–∑–Ω–∞—á–µ–Ω–∏–π –∫—Ä–∏—Ç–∏–∫–∞ –≤ –≤–∏–¥–µ 3D –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏:
- **–í—ã—Å–æ—Ç–∞** = Q-value (—á–µ–º –≤—ã—à–µ, —Ç–µ–º –ª—É—á—à–µ)
- **–¶–≤–µ—Ç** = –≥—Ä–∞–¥–∏–µ–Ω—Ç –æ—Ç –∫—Ä–∞—Å–Ω–æ–≥–æ (–ø–ª–æ—Ö–æ) –¥–æ –∑–µ–ª—ë–Ω–æ–≥–æ (—Ö–æ—Ä–æ—à–æ)
- –ê–≥–µ–Ω—Ç—ã –¥–≤–∏–∂—É—Ç—Å—è –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –Ω–∞ –≤—ã—Å–æ—Ç–µ Q-value

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (Stage 2)

–°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–ø-5 —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Stage 2)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–æ–≤

```python
from config import AppConfig

# –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ—Å–µ—Ç–∞
config = AppConfig.from_preset('medium')  # 'low', 'medium', 'high'

# –ò–ª–∏ –∫–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config = AppConfig(
    training=TrainingConfig(
        num_episodes=500,
        batch_size=64,
        exploration_noise=0.5
    ),
    visualization=VisualizationConfig(
        n_agents=25,
        trail_length=200,
        heatmap_grid=21
    )
)
```

### –ü—Ä–µ—Å–µ—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ü—Ä–µ—Å–µ—Ç | –ê–≥–µ–Ω—Ç—ã | Trail –¥–ª–∏–Ω–∞ | Heatmap grid | FPS (–ø—Ä–∏–º–µ—Ä–Ω–æ) |
|--------|--------|-------------|--------------|----------------|
| **low** | 10 | 100 | 15x15 | 120+ |
| **medium** | 25 | 200 | 21x21 | 60-90 |
| **high** | 50 | 300 | 31x31 | 30-60 |

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- **Batch GPU operations** - 1 forward pass –≤–º–µ—Å—Ç–æ N sequential
- **–ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
- **Decimation** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π N-–π —Ç–æ—á–∫–∏ –≤ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é
- **Rebuild frequency** - —Ä–µ–¥–∫–∞—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ mesh
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Q-–∑–Ω–∞—á–µ–Ω–∏–π** - –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö forward passes

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (Stage 2)

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ Stage 2 | –ü–æ—Å–ª–µ Stage 2 |
|---------|-----------|---------------|
| FPS (25 agents) | ~30 | 60-120 |
| GPU calls/frame | ~75 | ~5-10 |
| Visual agents update | ~32ms | ~1-2ms |
| Heatmap update | ~15ms | ~3-5ms |

---

## Development

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏

```python
from physics.policies import Policy

class MyPolicy(Policy):
    def get_action(self, state):
        # –í—ã—á–∏—Å–ª–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
        return action

    def get_actions_batch(self, states):
        # –í—ã—á–∏—Å–ª–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –±–∞—Ç—á–∞ (–¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        return actions

    def reset(self):
        # –°–±—Ä–æ—Å–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        pass
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

```python
class MyVisual:
    def __init__(self, object_manager, zoom_manager):
        # –°–æ–∑–¥–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —á–µ—Ä–µ–∑ object_manager
        self.entity = object_manager.create_object(...)

        # –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ zoom_manager
        zoom_manager.register_object(self, 'my_visual')

    def apply_transform(self, a, b, **kwargs):
        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∑—É–º–∞
        self.entity.position = self.real_position * a + b

    def set_zoom_manager(self, zoom_manager):
        self.zoom_manager = zoom_manager

    @property
    def enabled(self):
        return self.entity is not None
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
cd tests
py -3.12 test_policies.py
py -3.12 test_vectorized_env.py
py -3.12 test_performance.py

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
py -3.12 main.py
# –ù–∞–∂–∞—Ç—å F1 –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ CSV
```

---

## Roadmap

### Phase 0-9 ‚úÖ (–∑–∞–≤–µ—Ä—à–µ–Ω–æ 82.4%)
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ physics/visuals/managers
- Agent —Å –∫–æ–ª—å—Ü–µ–≤—ã–º –±—É—Ñ–µ—Ä–æ–º
- VectorizedEnvironment
- CALF –ø–æ–ª–∏—Ç–∏–∫–∞

### Stage 2 ‚è≥ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
- Batch operations –≤ CALFController
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ train_calf_visual ‚Üí main.py
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

### Stage 3 üìã (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- Plugin —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- TensorBoard –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Hierarchical agents
- Multi-point systems

---

## –°—Å—ã–ª–∫–∏

- **CALF paper**: "Critic as Lyapunov function (CALF): a model-free, stability-ensuring agent"
- **–î–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏—è**: Pavel Osinenko - "Reinforcement Learning with Guarantees" (2024)
- **TD3 paper**: "Addressing Function Approximation Error in Actor-Critic Methods"
- **Ursina Engine**: https://www.ursinaengine.org/

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

[–£–∫–∞–∑–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é]

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

[–£–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã]

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ RL**
