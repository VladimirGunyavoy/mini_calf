# Stage 2: Optimization & Architecture Refactoring

–ü–∞–ø–∫–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–µ–∫—Ç–∞ CALF.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### `00_START_HERE.md` - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.

**–°–æ–¥–µ—Ä–∂–∏—Ç**:
- –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã
- –ì–¥–µ –∏—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –°–∫–æ–ø–∏—Ä—É–π –ø—É—Ç—å –∫ —ç—Ç–æ–º—É —Ñ–∞–π–ª—É –∏ –ø–µ—Ä–µ–¥–∞–π –≤ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥.

---

### `01_OPTIMIZATION_PLAN.md` - –ü–ª–∞–Ω —Å –≥–∞–ª–æ—á–∫–∞–º–∏
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å –¢–ó –ø–æ —Å—Ç–∞–¥–∏—è–º.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- **–°–µ–∫—Ü–∏—è 1**: –ö—Ä–∞—Ç–∫–∏–π —á–µ–∫–ª–∏—Å—Ç (6 —Å—Ç–∞–¥–∏–π —Å –≥–∞–ª–æ—á–∫–∞–º–∏)
- **–°–µ–∫—Ü–∏—è 2**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –¢–ó –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏

**–°—Ç–∞–¥–∏–∏**:
1. STAGE 1: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è select_action_batch (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
2. STAGE 2: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. STAGE 3: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ main.py
4. STAGE 4: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
5. STAGE 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
6. STAGE 6: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ù–∞—á–Ω–∏ —Å –ø–µ—Ä–≤–æ–π –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏, –æ—Ç–º–µ—á–∞–π –≥–∞–ª–æ—á–∫–∏ –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

### `02_LESSONS_LEARNED.md` - –í—ã—É—á–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –±—É–¥—É—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤.

**–§–æ—Ä–º–∞—Ç**:
```
## Lesson N: [–î–∞—Ç–∞] –ù–∞–∑–≤–∞–Ω–∏–µ
**–ü—Ä–æ–±–ª–µ–º–∞**: –ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å
**–†–µ—à–µ–Ω–∏–µ**: –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª–∏
**–í—ã–≤–æ–¥**: –ß—Ç–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å
```

**–°–æ–¥–µ—Ä–∂–∏—Ç**:
- Lesson 1-17: –£—Ä–æ–∫–∏ –∏–∑ Phase 0-9 (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ PROMPT_FOR_NEXT_AGENT.md)
- Lesson 18+: –ù–æ–≤—ã–µ —É—Ä–æ–∫–∏ –∏–∑ Stage 2

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ü—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã - –¥–æ–±–∞–≤—å –Ω–æ–≤—ã–π —É—Ä–æ–∫ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞.

---

### `03_DECISIONS_LOG.md` - –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

**–§–æ—Ä–º–∞—Ç**:
```
## Decision N: [–î–∞—Ç–∞] –ù–∞–∑–≤–∞–Ω–∏–µ
**–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ü–æ—á–µ–º—É –Ω—É–∂–Ω–æ –±—ã–ª–æ —Ä–µ—à–∞—Ç—å
**–í–∞—Ä–∏–∞–Ω—Ç—ã**: –ß—Ç–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏
**–í—ã–±–æ—Ä**: –ß—Ç–æ –≤—ã–±—Ä–∞–ª–∏
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –ü–æ—á–µ–º—É
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**: –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ - –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —Ä–µ—à–µ–Ω–∏–µ.

---

## Workflow –¥–ª—è –∞–≥–µ–Ω—Ç–∞

### 1. –°—Ç–∞—Ä—Ç
```
1. –û—Ç–∫—Ä—ã—Ç—å 00_START_HERE.md
2. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∞–≤–∏–ª–∞
3. –û—Ç–∫—Ä—ã—Ç—å 01_OPTIMIZATION_PLAN.md
4. –ù–∞–π—Ç–∏ –ø–µ—Ä–≤—É—é –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é —Å—Ç–∞–¥–∏—é
```

### 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏
```
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –¢–ó –¥–ª—è —Å—Ç–∞–¥–∏–∏
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á–∏
3. –û—Ç–º–µ—Ç–∏—Ç—å –≥–∞–ª–æ—á–∫–∏ –≤ –ø–ª–∞–Ω–µ
4. –ó–∞–ø–∏—Å–∞—Ç—å —É—Ä–æ–∫–∏ –≤ 02_LESSONS_LEARNED.md
5. –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –≤ 03_DECISIONS_LOG.md
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
```
1. –°–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ç–∞–¥–∏–∏
2. –î–û–ñ–î–ê–¢–¨–°–Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: "—Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞–π"
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã - –∏—Å–ø—Ä–∞–≤–∏—Ç—å
4. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ OK - –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–¥–∏–∏
```

### 4. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ Stage 2
```
1. –í—Å–µ 6 —Å—Ç–∞–¥–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω—ã (–≥–∞–ª–æ—á–∫–∏ –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω—ã)
2. –°–æ–∑–¥–∞–Ω FINAL_REPORT.md —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
3. –û–±–Ω–æ–≤–ª–µ–Ω ursina/README.md
4. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ Stage 3
```

---

## –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã

### ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–¥–∏–∏ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –∑–∞–ø–∏—Å—å —É—Ä–æ–∫–æ–≤ –∏ —Ä–µ—à–µ–Ω–∏–π
- –ó–∞–±—ã–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª—è—Ç—å –≥–∞–ª–æ—á–∫–∏ –≤ –ø–ª–∞–Ω–µ
- –ú–µ–Ω—è—Ç—å working code –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
- –ß–∏—Ç–∞—Ç—å –¢–ó –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å—Ç–∞–¥–∏–∏
- –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å —É—Ä–æ–∫–∏ –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª—è—Ç—å –≥–∞–ª–æ—á–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏
- –ñ–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–¥–∏–µ–π

---

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

### –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
- `../../PERFORMANCE_ANALYSIS.md` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `../../RL/calf.py` - CALFController (–∫—Ä–∏—Ç–∏—á–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è STAGE 1)

### –ò–∑ llm/
- `../PROGRESS.md` - –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞ (Phase 0-9)
- `../PROMPT_FOR_NEXT_AGENT.md` - —É—Ä–æ–∫–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ñ–∞–∑
- `../ARCHITECTURE_ROADMAP.md` - –ø–ª–∞–Ω –∏–∑ 12 —Ñ–∞–∑

### –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã
- `../../config/` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (STAGE 2)
- `../../core/application.py` - CALFApplication (STAGE 3)
- `../../training/` - Trainer + Visualizer (STAGE 3)
- `../../utils/profiler.py` - –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (STAGE 4)

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ Stage 2

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [x] FPS: 30 ‚Üí 60-120
- [x] GPU –≤—ã–∑–æ–≤–æ–≤: ~75 ‚Üí ‚â§10
- [x] Train step: ~32ms ‚Üí ‚â§2ms

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [x] Config: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] main.py: ‚â§150 —Å—Ç—Ä–æ–∫
- [x] –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –£—Ä–æ–∫–∏: –∑–∞–ø–∏—Å–∞–Ω—ã
- [x] –†–µ—à–µ–Ω–∏—è: –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] README: –æ–±–Ω–æ–≤–ª—ë–Ω

---

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–ª—è –∞–≥–µ–Ω—Ç–∞
```
–Ø –Ω–æ–≤—ã–π –∞–≥–µ–Ω—Ç, –Ω–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É –Ω–∞–¥ Stage 2.

1. –ß–∏—Ç–∞—é 00_START_HERE.md
2. –û—Ç–∫—Ä—ã–≤–∞—é 01_OPTIMIZATION_PLAN.md
3. –í–∏–∂—É —á—Ç–æ STAGE 1 –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (–≥–∞–ª–æ—á–∫–∏ –ø—É—Å—Ç—ã–µ)
4. –ß–∏—Ç–∞—é –¢–ó –¥–ª—è STAGE 1
5. –ù–∞—á–∏–Ω–∞—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é select_action_batch –≤ RL/calf.py
6. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è - –æ—Ç–º–µ—á–∞—é –≥–∞–ª–æ—á–∫–∏
7. –ó–∞–ø–∏—Å—ã–≤–∞—é —É—Ä–æ–∫–∏ –≤ 02_LESSONS_LEARNED.md
8. –ñ–¥—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
1. –ê–≥–µ–Ω—Ç —Å–æ–æ–±—â–∞–µ—Ç: "STAGE 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π"
2. –ó–∞–ø—É—Å–∫–∞—é: py -3.12 train_calf_visual.py
3. –ü—Ä–æ–≤–µ—Ä—è—é: —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫, FPS >= 60
4. –û—Ç–≤–µ—á–∞—é: "—Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞–π"
5. –ê–≥–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ STAGE 2
```

---

## Troubleshooting

### –ê–≥–µ–Ω—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å
‚Üí –û—Ç–ø—Ä–∞–≤—å –µ–≥–æ –∫ `00_START_HERE.md` –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ê–≥–µ–Ω—Ç –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å—Ç–∞–¥–∏–∏
‚Üí –ù–∞–ø–æ–º–Ω–∏ –ø—Ä–∞–≤–∏–ª–æ: "–ñ–¥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–¥–∏–µ–π"

### –ê–≥–µ–Ω—Ç –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —É—Ä–æ–∫–∏
‚Üí –ù–∞–ø–æ–º–Ω–∏: "–ü—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã - –∑–∞–ø–∏—à–∏ –≤ 02_LESSONS_LEARNED.md"

### –ê–≥–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç –Ω–µ —Ç–æ
‚Üí –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –æ–Ω –ø—Ä–æ—á–∏—Ç–∞–ª –¢–ó –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –≤ 01_OPTIMIZATION_PLAN.md

---

**–£–¥–∞—á–∏ –≤ Stage 2! üöÄ**
